{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
    Page title
{% endblock %}

{% block content %}

    <p>Your are participant {{ participant.id_in_session }}.</p>

    <!--        NETWORK PRESENTATION        -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #nidm_network {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>
    <div id="nidm_network"></div>
    <script type="text/javascript">

        let p_id = Number(js_vars.p_id);
        let disease_states = js_vars.disease_states;
        let risk_perceptions = js_vars.risk_perceptions;
        let ties = js_vars.ties;

        // console.log("player ID: ".concat(p_id));
        // console.log("disease states: ".concat(disease_states));
        // for (let d in disease_states) {
        //     console.log(d)
        //     console.log(disease_states[d])
        // }
        // console.log("risk perceptions: ".concat(risk_perceptions));
        // for (let r in risk_perceptions) {
        //     console.log(r)
        //     console.log(risk_perceptions[r])
        // }
        // console.log("ties: ".concat(ties));
        // for (let t in ties) {
        //     console.log(t)
        //     console.log(ties[t])
        // }

        // create an array with nodes
        let nodes = new vis.DataSet();
        for (let d in disease_states) {
            if (disease_states.hasOwnProperty(d)) {
                d = Number(d);
                let ds = Number(disease_states[d]);
                let size = Number(risk_perceptions[d])*15;
                // node of player
                if (d ===  p_id) {
                    // susceptible
                    if (ds === 1) {
                        nodes.add({id: d, color: '#FECD0A', shape: 'star', size: size})
                    // infected
                    } else if (ds === 2) {
                        nodes.add({id: d, color: '#FF5500', shape: 'star', size: size})
                    // recovered
                    } else if (ds === 3) {
                        nodes.add({id: d, color: '#56B4E9', shape: 'star', size: size})
                    } else {
                        nodes.add({id: d, color: '#ffffff', shape: 'star', size: size})
                    }
                // nodes of other players
                } else {
                    // susceptible
                    if (ds === 1) {
                        nodes.add({id: d, label: d.toString(), color: '#FECD0A', shape: 'hexagon', size: size})
                    // infected
                    } else if (ds === 2) {
                        nodes.add({id: d, label: d.toString(), color: '#FF5500', shape: 'hexagon', size: size})
                    // recovered
                    } else if (ds === 3) {
                        nodes.add({id: d, label: d.toString(), color: '#56B4E9', shape: 'hexagon', size: size})
                    } else {
                        nodes.add({id: d, label: d.toString(), color: '#ffffff', shape: 'hexagon', size: size})
                    }
                }
            }
        }

        // create an array with edges
        let edges = new vis.DataSet();
        for (let src in ties) {
            if (ties.hasOwnProperty(src)) {
                src = Number(src);
                let ties_of_src = ties[src];
                for (let i = 0; i < ties_of_src.length; i++) {
                    let dest = Number(ties_of_src[i]);
                    edges.add({from: src, to: dest});
                }
            }
        }

        // create a network
        let container = document.getElementById('nidm_network');
        let data = {
            nodes: nodes,
            edges: edges
        };
        let options = {};
        let network = new vis.Network(container, data, options);
    </script>

    {% next_button %}

{% endblock %}
