{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
    Page title
{% endblock %}

{% block content %}

    <p>Your are participant {{ participant.id_in_session }}.</p>

    <!--        NETWORK PRESENTATION        -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #nidm_network {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>
    <div id="nidm_network"></div>
    <script type="text/javascript">

        let p_id = Number(js_vars.p_id);
        let disease_states = js_vars.disease_states;

        // console.log("player ID: ".concat(p_id));
        // console.log("disease states: ".concat(disease_states));
        // for (let d in disease_states) {
        //     console.log(d)
        //     console.log(disease_states[d])
        // }

        // create an array with nodes
        let nodes = new vis.DataSet();
        for (let d in disease_states) {
            if (disease_states.hasOwnProperty(d)) {
            d = Number(d);
            let ds = Number(disease_states[d]);
                // node of player
                if (d ===  p_id) {
                    // susceptible
                    if (ds === 1) {
                        nodes.add({id: d, color: '#FECD0A', shape: 'star', size: 30})
                    // infected
                    } else if (ds === 2) {
                        nodes.add({id: d, color: '#FF5500', shape: 'star', size: 30})
                    // recovered
                    } else if (ds === 3) {
                        nodes.add({id: d, color: '#56B4E9', shape: 'star', size: 30})
                    } else {
                        nodes.add({id: d, color: '#ffffff', shape: 'star', size: 30})
                    }
                // nodes of other players
                } else {
                    // susceptible
                    if (ds === 1) {
                        nodes.add({id: d, label: d.toString(), color: '#FECD0A', shape: 'circle'})
                    // infected
                    } else if (ds === 2) {
                        nodes.add({id: d, label: d.toString(), color: '#FF5500', shape: 'circle'})
                    // recovered
                    } else if (ds === 3) {
                        nodes.add({id: d, label: d.toString(), color: '#56B4E9', shape: 'circle'})
                    } else {
                        nodes.add({id: d, label: d.toString(), color: '#ffffff', shape: 'circle'})
                    }
                }
            }
        }

        {#for (let i = 1; i <= released.length; i++) {#}
        {#    if (i == p_id) {#}
        {#        nodes.add({id: i, color: '#999999', shape: 'star', size: 30})#}
        {#    } else {#}
        {#        nodes.add({id: i, label: i.toString(), color: '#999999', shape: 'circle'})#}
        {#    }#}
        //}

        // create an array with edges
        let edges = new vis.DataSet([
            {#{from: 1, to: 3},#}
            {from: 1, to: 2},
            {#{from: 2, to: 4},#}
            {#{from: 2, to: 5},#}
            {#{from: 3, to: 3}#}
        ]);

        // create a network
        let container = document.getElementById('nidm_network');
        let data = {
            nodes: nodes,
            edges: edges
        };
        let options = {};
        let network = new vis.Network(container, data, options);
    </script>

    {% next_button %}

{% endblock %}
